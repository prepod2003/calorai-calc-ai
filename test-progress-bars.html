<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #2563eb;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        pre {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        h2 { color: #1e293b; }
        code { background: #e2e8f0; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤</h1>
    
    <div class="section">
        <h2>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
        <button class="button" onclick="checkData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ localStorage</button>
        <div id="dataStatus"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <button class="button" onclick="createTestProfile()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å</button>
        <div id="profileStatus"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å progressPercentages –≤ –∏—Å—Ç–æ—Ä–∏—é</h2>
        <button class="button" onclick="addProgressToHistory()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –∏—Å—Ç–æ—Ä–∏—é</button>
        <div id="historyStatus"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 4: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
        <button class="button" onclick="window.location.href='/'">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        <p>–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –≤—ã—à–µ, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É "–ò—Å—Ç–æ—Ä–∏—è"</p>
    </div>

    <script>
        function checkData() {
            const profile = localStorage.getItem('user-profile');
            const history = localStorage.getItem('meal-history');
            
            let html = '<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            if (!profile) {
                html += '<div class="status error">‚ùå –ü—Ä–æ—Ñ–∏–ª—å –ù–ï –Ω–∞–π–¥–µ–Ω</div>';
                html += '<p>–ü—Ä–æ—Ñ–∏–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∫–Ω–æ–ø–∫–æ–π –Ω–∏–∂–µ.</p>';
            } else {
                try {
                    const profileData = JSON.parse(profile);
                    if (profileData.dailyGoals) {
                        html += '<div class="status success">‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞–π–¥–µ–Ω —Å –¥–Ω–µ–≤–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏</div>';
                        html += '<pre>' + JSON.stringify(profileData.dailyGoals, null, 2) + '</pre>';
                    } else {
                        html += '<div class="status warning">‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞–π–¥–µ–Ω, –Ω–æ –±–µ–∑ –¥–Ω–µ–≤–Ω—ã—Ö —Ü–µ–ª–µ–π</div>';
                    }
                } catch (e) {
                    html += '<div class="status error">‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è</div>';
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
            if (!history) {
                html += '<div class="status error">‚ùå –ò—Å—Ç–æ—Ä–∏—è –ù–ï –Ω–∞–π–¥–µ–Ω–∞</div>';
                html += '<p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –±–ª—é–¥–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.</p>';
            } else {
                try {
                    const historyData = JSON.parse(history);
                    const dates = Object.keys(historyData);
                    html += `<div class="status success">‚úÖ –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (${dates.length} –¥–Ω–µ–π)</div>`;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ progressPercentages
                    let hasProgress = 0;
                    dates.forEach(date => {
                        if (historyData[date].progressPercentages) {
                            hasProgress++;
                        }
                    });
                    
                    if (hasProgress === 0) {
                        html += '<div class="status warning">‚ö†Ô∏è –í –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç progressPercentages</div>';
                        html += '<p>–í—ã–ø–æ–ª–Ω–∏—Ç–µ –®–∞–≥ 3 –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.</p>';
                    } else {
                        html += `<div class="status success">‚úÖ progressPercentages –µ—Å—Ç—å –≤ ${hasProgress} –∏–∑ ${dates.length} –¥–Ω–µ–π</div>`;
                    }
                } catch (e) {
                    html += '<div class="status error">‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏</div>';
                }
            }
            
            document.getElementById('dataStatus').innerHTML = html;
        }
        
        function createTestProfile() {
            const testProfile = {
                name: "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                gender: "male",
                age: 30,
                weight: 75,
                height: 175,
                activityLevel: "moderate",
                goal: "maintain",
                dailyGoals: {
                    bmr: 1700,
                    tdee: 2350,
                    targetCalories: 2350,
                    protein: 120,
                    fat: 65,
                    carbohydrate: 290,
                    fiber: 30
                }
            };
            
            localStorage.setItem('user-profile', JSON.stringify(testProfile));
            
            document.getElementById('profileStatus').innerHTML = `
                <div class="status success">‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω!</div>
                <pre>${JSON.stringify(testProfile.dailyGoals, null, 2)}</pre>
                <p>–¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –®–∞–≥ 3 –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</p>
            `;
        }
        
        function addProgressToHistory() {
            const history = localStorage.getItem('meal-history');
            const profile = localStorage.getItem('user-profile');
            
            if (!history) {
                document.getElementById('historyStatus').innerHTML = `
                    <div class="status error">‚ùå –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>
                    <p>–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –±–ª—é–¥–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.</p>
                `;
                return;
            }
            
            if (!profile) {
                document.getElementById('historyStatus').innerHTML = `
                    <div class="status error">‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</div>
                    <p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å (–®–∞–≥ 2).</p>
                `;
                return;
            }
            
            try {
                const historyData = JSON.parse(history);
                const profileData = JSON.parse(profile);
                
                if (!profileData.dailyGoals) {
                    document.getElementById('historyStatus').innerHTML = `
                        <div class="status error">‚ùå –í –ø—Ä–æ—Ñ–∏–ª–µ –Ω–µ—Ç –¥–Ω–µ–≤–Ω—ã—Ö —Ü–µ–ª–µ–π</div>
                    `;
                    return;
                }
                
                let updatedCount = 0;
                Object.keys(historyData).forEach(date => {
                    const totals = historyData[date].dailyTotals;
                    historyData[date].progressPercentages = {
                        calories: Math.round((totals.calories / profileData.dailyGoals.targetCalories) * 100),
                        protein: Math.round((totals.protein / profileData.dailyGoals.protein) * 100),
                        fat: Math.round((totals.fat / profileData.dailyGoals.fat) * 100),
                        carbohydrate: Math.round((totals.carbohydrate / profileData.dailyGoals.carbohydrate) * 100),
                        fiber: Math.round((totals.fiber / profileData.dailyGoals.fiber) * 100)
                    };
                    updatedCount++;
                });
                
                localStorage.setItem('meal-history', JSON.stringify(historyData));
                
                document.getElementById('historyStatus').innerHTML = `
                    <div class="status success">‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ ${updatedCount} –¥–Ω–µ–π!</div>
                    <p>–¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É "–ò—Å—Ç–æ—Ä–∏—è".</p>
                    <p>–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –ø–æ–¥ –∫–∞–∂–¥—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–º –ö–ë–ñ–£.</p>
                `;
            } catch (e) {
                document.getElementById('historyStatus').innerHTML = `
                    <div class="status error">‚ùå –û—à–∏–±–∫–∞: ${e.message}</div>
                `;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = checkData;
    </script>
</body>
</html>
