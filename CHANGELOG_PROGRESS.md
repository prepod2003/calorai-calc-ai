# Changelog: Визуализация прогресса по дневным целям

## Измененные файлы

### 1. `types.ts`
- Добавлено необязательное поле `progressPercentages` в интерфейс `HistoryEntry`
- Хранит проценты выполнения для каждого показателя КБЖУ

### 2. `utils/calculations.ts`
- Добавлена функция `calculateProgressPercentages()`
- Принимает дневные итоги и цели из профиля
- Возвращает объект с процентами для каждого нутриента
- Возвращает `null` если цели не установлены

### 3. `App.tsx`
**Импорты:**
- Добавлен импорт `calculateProgressPercentages` из utils/calculations

**Обновленные функции:**
- `handleSaveDish()`: теперь рассчитывает и сохраняет проценты при добавлении блюда
- `handleRemoveMeal()`: пересчитывает проценты при удалении блюда

**Новый useEffect:**
- Миграция старых данных истории при изменении профиля
- Добавляет проценты к существующим записям без них
- Зависимость только от `userProfile` для избежания циклов

### 4. `components/HistoryView.tsx`
**Обновленный компонент `NutritionLabel`:**
- Добавлены опциональные пропсы: `percentage` и `goal`
- Логика цветового кодирования:
  - Норма (<110%): цвета соответствуют нутриенту
  - Превышение (≥110%): красный цвет
- Отображение прогресс-бара с процентом
- Отображение целевого значения под прогресс-баром

**Обновлен рендеринг дней:**
- Извлечение `progressPercentages` и `dailyGoals` из данных
- Передача процентов и целей в компоненты `NutritionLabel`

## Новые файлы

### `PROGRESS_FEATURE.md`
Документация по новой функциональности

### `CHANGELOG_PROGRESS.md`
Этот файл - техническая документация изменений

## Преимущества реализации

1. **Производительность**: Проценты рассчитываются один раз при изменении данных, а не при каждом рендере
2. **Историческая точность**: Данные сохраняются с процентами, что сохраняет историческую точность даже при изменении целей
3. **Обратная совместимость**: Старые данные автоматически мигрируются
4. **Опциональность**: Функция работает только при наличии профиля с целями
5. **Визуальная обратная связь**: Цветовое кодирование помогает быстро оценить прогресс

## Тестирование

Проект успешно собирается:
```bash
npm run build
✓ 43 modules transformed
✓ built in 1.26s
```

Сервер разработки запускается без ошибок:
```bash
npm run dev
VITE v6.3.6 ready in 398 ms
➜ Local: http://localhost:5173/calorai-calc-ai/
```
